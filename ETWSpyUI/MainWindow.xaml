<Window x:Class="ETWSpyUI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ETWSpyUI"
        mc:Ignorable="d"
        Style="{StaticResource ThemedWindow}"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Title="ETWSpy - Event Tracing Monitor" 
        Height="600" 
        Width="1000"
        MinHeight="400"
        MinWidth="600">
    <Grid Background="{DynamicResource SecondaryBackgroundBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{DynamicResource TertiaryBackgroundBrush}" Padding="2">
            <MenuItem Header="_File">
                <MenuItem Header="_Open..." Click="LoadFromFile" InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Save..." Click="SaveToFile" InputGestureText="Ctrl+S">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click" InputGestureText="Alt+F4">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE8BB;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Providers..." Click="ShowProviders_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE74C;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem x:Name="FiltersMenuItem" Header="_Filters..." Click="ShowFilters_Click" IsEnabled="False">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE71C;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Settings">
                <MenuItem Header="_Theme">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE790;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                    <MenuItem x:Name="LightThemeMenuItem" Header="_Light" Click="LightTheme_Click" IsCheckable="True"/>
                    <MenuItem x:Name="DarkThemeMenuItem" Header="_Dark" Click="DarkTheme_Click" IsCheckable="True"/>
                    <MenuItem x:Name="SystemThemeMenuItem" Header="_Use System Theme" Click="SystemTheme_Click" IsCheckable="True"/>
                </MenuItem>
                <MenuItem Header="Time _Format">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE823;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                    <MenuItem x:Name="TimeFormatLocalMenuItem" Header="_Local" Click="TimeFormatLocal_Click" IsCheckable="True"/>
                    <MenuItem x:Name="TimeFormatUTCMenuItem" Header="_UTC" Click="TimeFormatUTC_Click" IsCheckable="True"/>
                </MenuItem>
                <MenuItem Header="_Max Events to Show">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE9D9;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                    <MenuItem x:Name="MaxEvents1000MenuItem" Header="_1,000" Click="MaxEvents1000_Click" IsCheckable="True"/>
                    <MenuItem x:Name="MaxEvents10000MenuItem" Header="1_0,000" Click="MaxEvents10000_Click" IsCheckable="True"/>
                    <MenuItem x:Name="MaxEvents100000MenuItem" Header="10_0,000" Click="MaxEvents100000_Click" IsCheckable="True"/>
                </MenuItem>
                <MenuItem x:Name="AutoscrollMenuItem" Header="_Autoscroll" Click="Autoscroll_Click" IsCheckable="True" IsChecked="True">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE74B;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Check for Updates" Click="CheckForUpdates_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE895;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_About" Click="About_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="&#xE946;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBarTray Grid.Row="1" Background="{DynamicResource TertiaryBackgroundBrush}" IsLocked="True">
            <ToolBar Background="{DynamicResource TertiaryBackgroundBrush}" Padding="6,4" Band="0" BandIndex="0">
                <Button Click="LoadFromFile" ToolTip="Open Configuration (Ctrl+O)" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button Click="SaveToFile" ToolTip="Save Configuration (Ctrl+S)" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Separator/>
                <Button Click="ShowProviders_Click" ToolTip="Providers - Configure ETW providers" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE74C;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button x:Name="FiltersToolbarButton" Click="ShowFilters_Click" ToolTip="Filters - Configure event filters" IsEnabled="False" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE71C;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Separator/>
                <Button x:Name="StartPauseToolbarButton" Click="PauseResumeTracing" ToolTip="Start/Pause event capture" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock x:Name="StartPauseToolbarIcon" Text="&#xE768;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button x:Name="EventDetailsToolbarButton" Click="ShowEventDetailsButton_Click" ToolTip="View event details" IsEnabled="False" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE90F;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button x:Name="CopyToolbarButton" Click="CopySelectedEvents" ToolTip="Copy selected events (Ctrl+C)" IsEnabled="False" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE8C8;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button Click="ClearEvents" ToolTip="Clear all captured events" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
                <Button Click="ExportToCsv" ToolTip="Export events to CSV file" Style="{DynamicResource ToolbarButtonStyle}">
                    <TextBlock Text="&#xEDE1;" FontFamily="Segoe MDL2 Assets" FontSize="20"/>
                </Button>
            </ToolBar>
        </ToolBarTray>

        <!-- Main Content - Events -->
        <Grid Grid.Row="2" Background="{DynamicResource SecondaryBackgroundBrush}" Margin="10">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <DataGrid Grid.Row="0" 
                      x:Name="EventsDataGrid"
                      AutoGenerateColumns="True"
                      AutoGeneratingColumn="EventsDataGrid_AutoGeneratingColumn"
                      IsReadOnly="True"
                      SelectionMode="Extended"
                      SelectionChanged="EventsDataGrid_SelectionChanged"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Auto"
                      EnableRowVirtualization="True"
                      EnableColumnVirtualization="True"
                      VirtualizingPanel.IsVirtualizing="True"
                      VirtualizingPanel.VirtualizationMode="Recycling"
                      VirtualizingPanel.ScrollUnit="Pixel"
                      ScrollViewer.IsDeferredScrollingEnabled="True"
                      PreviewKeyDown="EventsDataGrid_PreviewKeyDown"
                      MouseDoubleClick="EventsDataGrid_MouseDoubleClick">
            </DataGrid>

            <Grid Grid.Row="1" Background="{DynamicResource SecondaryBackgroundBrush}" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Row="0" Grid.Column="0" x:Name="EventCountText" 
                           Text="Events: 0" 
                           VerticalAlignment="Center"
                           Margin="0,0,20,0"/>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" 
                Background="{DynamicResource TertiaryBackgroundBrush}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,1,0,0"
                Padding="10,5">
            <TextBlock x:Name="StatusTextBlock" Text="Ready" FontSize="12"/>
        </Border>
    </Grid>
</Window>
